<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://catpaws.top/blog-resource/imgs/webicon.png"><link rel="icon" href="https://catpaws.top/blog-resource/imgs/webicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="猫爪在上"><meta name="keywords" content=""><meta name="description" content="一、简介 https:&#x2F;&#x2F;mybatis.org&#x2F;mybatis-3&#x2F;zh&#x2F;index.html 1.1、什么是mybatis  MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。 MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。 MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Jav"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis"><meta property="og:url" content="https://catpaws.top/1bff3c65/index.html"><meta property="og:site_name" content="猫爪在上の书桌"><meta property="og:description" content="一、简介 https:&#x2F;&#x2F;mybatis.org&#x2F;mybatis-3&#x2F;zh&#x2F;index.html 1.1、什么是mybatis  MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。 MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。 MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Jav"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/cmyk359/img/raw/master/img/image-20220525091721413-2024-12-922:03:51.png"><meta property="og:image" content="https://gitee.com/cmyk359/img/raw/master/img/mybatis-2024-12-922:11:32.png"><meta property="og:image" content="https://gitee.com/cmyk359/img/raw/master/img/image-20220530093648543-2024-12-922:12:06.png"><meta property="article:published_time" content="2024-12-09T13:50:55.000Z"><meta property="article:modified_time" content="2025-07-02T08:03:33.470Z"><meta property="article:author" content="猫爪在上"><meta property="article:tag" content="MyBatis"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://gitee.com/cmyk359/img/raw/master/img/image-20220525091721413-2024-12-922:03:51.png"><title>MyBatis - 猫爪在上の书桌</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/font.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/poem.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/shubiao.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/loader.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/twikoo_beautify.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/indeximg-hover.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/wave.css"><link rel="stylesheet" href="//catpaws.top/blog-resource/css/blurpicload.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"catpaws.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"https://catpaws.top/blog-resource/imgs/transparent.svg",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:"TNTPv22capMq3aFV9S0sLqSm-gzGzoHsz",app_key:"G2BBAxXmiixopVg5mIJ2sxXR",server_url:"https://leancloud.catpaws.top",path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loader-container"><div class="loader"><div class="wrapper"><div class="catContainer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 733 673" class="catbody"><path fill="#212121" d="M111.002 139.5C270.502 -24.5001 471.503 2.4997 621.002 139.5C770.501 276.5 768.504 627.5 621.002 649.5C473.5 671.5 246 687.5 111.002 649.5C-23.9964 611.5 -48.4982 303.5 111.002 139.5Z"></path><path fill="#212121" d="M184 9L270.603 159H97.3975L184 9Z"></path><path fill="#212121" d="M541 0L627.603 150H454.397L541 0Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 158 564" class="tail"><path fill="#191919" d="M5.97602 76.066C-11.1099 41.6747 12.9018 0 51.3036 0V0C71.5336 0 89.8636 12.2558 97.2565 31.0866C173.697 225.792 180.478 345.852 97.0691 536.666C89.7636 553.378 73.0672 564 54.8273 564V564C16.9427 564 -5.4224 521.149 13.0712 488.085C90.2225 350.15 87.9612 241.089 5.97602 76.066Z"></path></svg><div class="text"><span class="bigzzz">Z</span> <span class="zzz">Z</span></div></div><div class="wallContainer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 500 126" class="wall"><line stroke-width="6" stroke="#7C7C7C" y2="3" x2="450" y1="3" x1="50"></line><line stroke-width="6" stroke="#7C7C7C" y2="85" x2="400" y1="85" x1="100"></line><line stroke-width="6" stroke="#7C7C7C" y2="122" x2="375" y1="122" x1="125"></line><line stroke-width="6" stroke="#7C7C7C" y2="43" x2="500" y1="43"></line><line stroke-width="6" stroke="#7C7C7C" y2="1.99391" x2="115.5" y1="43.0061" x1="115.5"></line><line stroke-width="6" stroke="#7C7C7C" y2="2.00002" x2="189" y1="43.0122" x1="189"></line><line stroke-width="6" stroke="#7C7C7C" y2="2.00612" x2="262.5" y1="43.0183" x1="262.5"></line><line stroke-width="6" stroke="#7C7C7C" y2="2.01222" x2="336" y1="43.0244" x1="336"></line><line stroke-width="6" stroke="#7C7C7C" y2="2.01833" x2="409.5" y1="43.0305" x1="409.5"></line><line stroke-width="6" stroke="#7C7C7C" y2="43" x2="153" y1="84.0122" x1="153"></line><line stroke-width="6" stroke="#7C7C7C" y2="43" x2="228" y1="84.0122" x1="228"></line><line stroke-width="6" stroke="#7C7C7C" y2="43" x2="303" y1="84.0122" x1="303"></line><line stroke-width="6" stroke="#7C7C7C" y2="43" x2="378" y1="84.0122" x1="378"></line><line stroke-width="6" stroke="#7C7C7C" y2="84" x2="192" y1="125.012" x1="192"></line><line stroke-width="6" stroke="#7C7C7C" y2="84" x2="267" y1="125.012" x1="267"></line><line stroke-width="6" stroke="#7C7C7C" y2="84" x2="342" y1="125.012" x1="342"></line></svg></div></div></div></div><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>猫爪在上の书桌</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-addrcard"></i> <span>个人主页</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> <span>博客</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/" target="_self"><i class="iconfont icon-pen"></i> <span>文章</span> </a><a class="dropdown-item" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span> </a><a class="dropdown-item" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span> </a><a class="dropdown-item" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></div></li><li class="nav-item"><a class="nav-link" href="/messages/" target="_self"><i class="iconfont icon-comment"></i> <span>留言板</span></a></li><li class="nav-item"><a class="nav-link" href="/timeline/" target="_self"><i class="iconfont icon-images"></i> <span>时光轴</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://catpaws.top/blog-resource/imgs/article-bg.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="MyBatis"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-12-09 21:50" pubdate>2024年12月9日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 9.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 78 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">MyBatis</h1><p id="updated-time" class="note note-info">本文最后更新于 2025年7月2日 下午</p><div class="markdown-body"><meta name="referrer" , content="no-referrer"><h2 id="一简介">一、简介</h2><p>https://mybatis.org/mybatis-3/zh/index.html</p><h3 id="什么是mybatis">1.1、什么是mybatis</h3><ul><li>MyBatis 是一款优秀的<strong>持久层</strong>框架，它支持自定义 SQL、存储过程以及高级映射。</li><li>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</li><li>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li></ul><h3 id="持久化动作">1.2、持久化（动作）</h3><p>数据持久化</p><ul><li>持久化就是将程序的数据在持久状态和瞬时状态转化的过程</li><li>内存：断电即失</li><li>数据库（Jdbc），io文件持久化。</li><li>生活：冷藏.罐头。</li></ul><h3 id="持久层名词">1.3、持久层（名词）</h3><p>Dao层，Service层，Controller层.</p><ul><li>完成持久化工作的代码块</li><li>层界限十分明显。</li></ul><h2 id="二第一个mybatis程序">二、第一个mybatis程序</h2><h3 id="搭建环境">2.1、搭建环境</h3><h3 id="创建一个模块">2.2、创建一个模块</h3><h4 id="编写mybatis核心配置文件">编写mybatis核心配置文件</h4><p>每个基于 MyBatis 的应用都是以一个 <strong>SqlSessionFactory</strong> 的实例为核心的。SqlSessionFactory 的实例可以通过SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 <strong>XML 配置文件</strong>或一个预先配置的 Configuration 实例来构建出 SqlSessionFactory 实例。</p><p>XML 配置文件中包含了对 MyBatis 系统的核心设置，包括获取数据库连接实例的数据源（DataSource）以及决定事务作用域和控制方式的事务管理器（TransactionManager）。后面会再探讨 XML 配置文件的详细内容，这里先给出一个简单的示例：</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">configuration</span></span>
<span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>

<span class="hljs-comment">&lt;!--configuration 核心配置文件--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mybatis?serverTimezone=Hongkong<span class="hljs-symbol">&amp;amp;</span>useSSL=false<span class="hljs-symbol">&amp;amp;</span>useUnicode=true<span class="hljs-symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;liuhao123&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>

    <span class="hljs-comment">&lt;!--每一个Mapper.xml文件都需要在mybatis核心配置文件中注册--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;com/hao/dao/UserMapper.xml&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div><p>从 XML 文件中构建 SqlSessionFactory 的实例非常简单，建议使用类路径下的资源文件进行配置。 但也可以使用任意的输入流（InputStream）实例，比如用文件路径字符串或 file:// URL 构造的输入流。MyBatis 包含一个名叫 Resources 的工具类，它包含一些实用方法，使得从类路径或其它位置加载资源文件更加容易。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;org/mybatis/example/mybatis-config.xml&quot;</span>; <span class="hljs-comment">//xml文件</span>
<span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(resource);  <span class="hljs-comment">//读取xml文件</span>
<span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sqlSessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(inputStream); <span class="hljs-comment">//加载文件流创建工厂</span></code></pre></div><p>既然有了 SqlSessionFactory，顾名思义，我们可以从中获得 SqlSession 的实例。SqlSession 提供了在数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession()) &#123;
  <span class="hljs-type">Blog</span> <span class="hljs-variable">blog</span> <span class="hljs-operator">=</span> (Blog) session.selectOne(<span class="hljs-string">&quot;org.mybatis.example.BlogMapper.selectBlog&quot;</span>, <span class="hljs-number">101</span>);
&#125;</code></pre></div><p>诚然，这种方式能够正常工作，对使用旧版本 MyBatis 的用户来说也比较熟悉。但现在有了一种更简洁的方式——使用和指定语句的参数和返回值相匹配的接口（比如 BlogMapper.class），现在你的代码不仅更清晰，更加类型安全，还不用担心可能出错的字符串字面值以及强制类型转换。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession()) &#123;
  <span class="hljs-type">BlogMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> session.getMapper(BlogMapper.class);
  <span class="hljs-type">Blog</span> <span class="hljs-variable">blog</span> <span class="hljs-operator">=</span> mapper.selectBlog(<span class="hljs-number">101</span>);
&#125;</code></pre></div><h4 id="编写mybatis工具类">编写mybatis工具类</h4><p>通过上述方法，创建工具类</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hao.utils;

<span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;


<span class="hljs-comment">//sqlSessionFactor ---&gt;sqlSession</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisUtils</span> &#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory sqlSessionFactory;
    <span class="hljs-keyword">static</span> &#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//获取sqlSessionFactory对象</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>; <span class="hljs-comment">//xml文件</span>
            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(resource);  <span class="hljs-comment">//读取xml文件</span>
             sqlSessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(inputStream); <span class="hljs-comment">//加载文件流创建工厂</span>
        &#125;<span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;
	<span class="hljs-comment">//返回sqlSession对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSqlSession</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> sqlSessionFactory.openSession();
    &#125;
&#125;
</code></pre></div><h3 id="编写代码">2.3、编写代码</h3><ul><li><p>实体类</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hao.pojo;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String pwd;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> &#123;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(<span class="hljs-type">int</span> id, String name, String pwd)</span> &#123;
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.pwd = pwd;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> id;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;
        <span class="hljs-built_in">this</span>.id = id;
    &#125;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> name;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;
        <span class="hljs-built_in">this</span>.name = name;
    &#125;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPwd</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> pwd;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPwd</span><span class="hljs-params">(String pwd)</span> &#123;
        <span class="hljs-built_in">this</span>.pwd = pwd;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +
                <span class="hljs-string">&quot;id=&quot;</span> + id +
                <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +
                <span class="hljs-string">&quot;, pwd=&#x27;&quot;</span> + pwd + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +
                <span class="hljs-string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;
</code></pre></div></li><li><p>Dao接口</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hao.dao;

<span class="hljs-keyword">import</span> com.hao.pojo.User;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> &#123;
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getUserList</span><span class="hljs-params">()</span>;

&#125;
</code></pre></div></li><li><p>接口实现类 : 由原来的UseDaoImpl 转变为一个Mapper配置文件</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span>
<span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>

<span class="hljs-comment">&lt;!--namespace 绑定一个Dao/Mapper接口 ，相当于创建了对应接口的实现类--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!--id绑定对应接口的方法 ，相当于实现该方法。  select 查询语句。 resultType/resultMap 返回结果--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.hao.pojo.User&quot;</span>&gt;</span>
        select * from mybatis.user
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div></li></ul><h3 id="测试">2.4、测试</h3><p>注意点：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//UserDao这个Mapper没有被注册</span>
org.apache.ibatis.binding.BindingException: Type <span class="hljs-keyword">interface</span> <span class="hljs-title class_">com</span>.hao.dao.UserDao is not known to the MapperRegistry.</code></pre></div><p><strong>每一个Mapper.xml文件都需要在mybatis核心配置文件中注册</strong></p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hao.dao;

<span class="hljs-keyword">import</span> com.hao.pojo.User;
<span class="hljs-keyword">import</span> com.hao.utils.MybatisUtils;
<span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSession;
<span class="hljs-keyword">import</span> org.junit.Test;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoTest</span> &#123;
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-comment">//1、获取SQLSession对象</span>
        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();

        <span class="hljs-comment">//2、执行sql</span>
        <span class="hljs-type">UserDao</span> <span class="hljs-variable">userDao</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserDao.class);
        List&lt;User&gt; userList = userDao.getUserList();

        <span class="hljs-keyword">for</span> (User user: userList) &#123;
            System.out.println(user.toString());
        &#125;

        <span class="hljs-comment">//3、关闭SQLSession</span>
        sqlSession.close();
    &#125;
&#125;
</code></pre></div><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220519220624809-2024-12-921:58:36.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220519220624809"><figcaption aria-hidden="true">image-20220519220624809</figcaption></figure><p>----------------------编写流程：</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220519221147004-2024-12-921:58:45.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220519221147004"><figcaption aria-hidden="true">image-20220519221147004</figcaption></figure><h2 id="三crud">三、CRUD</h2><h3 id="namespace">3.1、namespace</h3><p>namespace中的包名要和Dao/mapper接口的包名一致！</p><h3 id="select">3.2、select</h3><p>参数：</p><ul><li>id：对应namespace中的方法名，即绑定对应接口中的一个方法。<ul><li>resultType：sql语句的返回值类型</li></ul></li><li>parameterType：参数类型</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.hao.pojo.User&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span>
    select * from mybatis.user where id = #&#123;id&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>通过<strong>#{}</strong>读取对应方法中的参数</p><h4 id="模糊查询">模糊查询</h4><ol type="1"><li><p>java代码执行的时候添加通配符</p><div class="code-wrapper"><pre><code class="hljs java">List&lt;User&gt; userList = userMapper.getUserListByLike(<span class="hljs-string">&quot;%李%&quot;</span>);</code></pre></div></li><li><p>在sql拼接中使用通配符（存在sql注入风险）</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserListByLike&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.hao.pojo.User&quot;</span>&gt;</span>
    select * from mybatis.user where name like &quot;%&quot;#&#123;value&#125;&quot;%&quot;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div></li></ol><h3 id="insert">3.3、insert</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//添加一个用户</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span>;</code></pre></div><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--参数对象中的属性可以直接取出来--&gt;</span>    
<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;com.hao.pojo.User&quot;</span>&gt;</span>
        insert into mybatis.user (id, name, pwd) values (#&#123;id&#125;, #&#123;name&#125;, #&#123;pwd&#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><p>测试时注意：<strong>增删改需要提交事务后才能生效</strong></p><p>测试:</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;
        <span class="hljs-comment">//1、获取SQLSession对象</span>
        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();

        <span class="hljs-comment">//2、执行sql</span>
        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">userMapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;赵六&quot;</span>, <span class="hljs-string">&quot;1234567&quot;</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> userMapper.addUser(user);
        <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) &#123;
            System.out.println(<span class="hljs-string">&quot;执行成功！&quot;</span>);
        &#125;

        <span class="hljs-comment">//提交事务</span>
        sqlSession.commit();
        
        <span class="hljs-comment">//3、关闭SQLSession</span>
        sqlSession.close();
    &#125;</code></pre></div><p>万能的map</p><p>当我们的实体类或数据库中的表，参数或者字段过多时，我们应当考虑使用map。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-title function_">addUser2</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span>;</code></pre></div><p>使用map时，通过map的key来取得数据。key可以自己定义，不必和数据库字段或实体类属性相同。可以传递任意个。</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser2&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span>
    insert into mybatis.user (id, name, pwd) values (#&#123;userId&#125;, #&#123;userName&#125;, #&#123;password&#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser2</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-comment">//1、获取SQLSession对象</span>
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();

    <span class="hljs-comment">//2、执行sql</span>
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">userMapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    
    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    map.put(<span class="hljs-string">&quot;userId&quot;</span>,<span class="hljs-number">2</span>);
    map.put(<span class="hljs-string">&quot;userName&quot;</span>,<span class="hljs-string">&quot;李四&quot;</span>);
    map.put(<span class="hljs-string">&quot;password&quot;</span>,<span class="hljs-string">&quot;1231456&quot;</span>);

    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> userMapper.addUser2(map);
    <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) &#123;
        System.out.println(<span class="hljs-string">&quot;执行成功！&quot;</span>);
    &#125;

    <span class="hljs-comment">//提交事务</span>
    sqlSession.commit();
    <span class="hljs-comment">//3、关闭SQLSession</span>
    sqlSession.close();
&#125;</code></pre></div><ul><li>map传递参数，直接在sql中取出key即可。</li><li>对象传递参数，直接在sql中取出对象属性即可。</li><li>只有一个基本类型参数的情况下，可以直接在sql中取到。</li></ul><h3 id="update">3.4、update</h3><h3 id="delete">3.5、 delete</h3><h2 id="四配置解析">四、配置解析</h2><h3 id="核心配置文件">4.1、核心配置文件</h3><p>mybatis-config.xml</p><p>MyBatis 配置包含对 MyBatis 行为有显着影响的设置和属性。文档的高层结构如下：</p><ul><li>configuration（配置）<ul><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#properties">properties（属性）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#settings">settings（设置）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeAliases">typeAliases（类型别名）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">typeHandlers（类型处理器）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory">objectFactory（对象工厂）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins">plugins（插件）</a></li><li>environments（环境配置）<ul><li>environment（环境变量）<ul><li>transactionManager（事务管理器）</li><li>dataSource（数据源）</li></ul></li></ul></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider">databaseIdProvider（数据库厂商标识）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#mappers">mappers（映射器）</a></li></ul></li></ul><h3 id="环境配置enviroments">4.2、环境配置(enviroments)</h3><p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中</p><p><strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong>所以，如果你想连接两个数据库，就需要创建两个 SqlSessionFactory 实例，每个数据库对应一个。</p><p>为了指定创建哪种环境，只要将它作为可选的参数传递给 SqlSessionFactoryBuilder 即可。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(reader, environment);
<span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(reader, environment, properties);</code></pre></div><p>如果忽略了环境参数(enviroment)，那么将会加载默认环境。</p><p>environments 元素定义了如何配置环境。</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>  
  <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>		
    <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;...&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">transactionManager</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span></code></pre></div><ul><li>默认环境是 id为development的环境</li><li>每个环境包含 <strong>事务管理器的配置</strong>(transactionManager) 和 <strong>数据源的配置</strong>(dataSource)</li></ul><p><strong>事务管理器(transactionManager)</strong></p><p>​ 在 MyBatis 中有两种类型的事务管理器（也就是 type="[<strong>JDBC</strong>|<strong>MANAGED</strong>]"）</p><ul><li><p>JDBC</p></li><li><p>这个配置直接使用了 JDBC 的提交和回滚功能，它依赖从数据源获得的连接来管理事务作用域。</p></li><li><p>MANAGED</p><ul><li>这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期。</li></ul></li></ul><p><strong>数据源(dataSource)</strong></p><p>​ dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p><p>​ 有三种内建的数据源类型（也就是 type="[<strong>UNPOOLED</strong>|<strong>POOLED</strong>|<strong>JNDI</strong>]"）：</p><ul><li>UNPOOLED<ul><li>没有连接池。这个数据源的实现会每次请求时打开和关闭连接。</li></ul></li></ul><p><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525091721413-2024-12-922:03:51.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525091721413" style="zoom:150%"></p><ul><li>POOLED<ul><li>带连接池的。每次从池中获取链接，使用完后回收链接而不是关闭。避免了创建新的连接实例时所必需的初始化和认证时间。</li><li>常用的数据库连接池：dbcp、c3p0、druid</li><li>默认是有池的连接 <img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525091703820-2024-12-922:04:01.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525091703820"></li></ul></li><li>JNDI<ul><li>这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用。</li></ul></li></ul><p><strong>Mybatis默认使用的事务管理器是JDBC，数据源默认使用连接池：POOLED</strong></p><h3 id="属性properties">4.3、属性(properties)</h3><p>我们可以通过properties属性来实现引用配置文件</p><p>这些属性都是可外部配置且可动态替换的，既可以在典型的Java属性文件中配置，亦可通过properties元素的子元素来传递。【db.properties】</p><ul><li><p>编写一个配置文件 dp.properties</p><p></p><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">driver</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span>
<span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=Hongkong&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>
<span class="hljs-attr">username</span>=<span class="hljs-string">root   </span>
<span class="hljs-attr">password</span>=<span class="hljs-string">liuhao123</span></code></pre></div><p></p></li><li><p>在核心配置文件中引入</p><div class="code-wrapper"><pre><code class="hljs xml">   <span class="hljs-comment">&lt;!--引入配置文件--&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;dp.properties&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123456&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    
<span class="hljs-comment">&lt;!--使用配置文件中的属性，通过$&#123;&#125;--&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;JDBC&quot;</span>/&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;POOLED&quot;</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driver&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span>
           <span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span></code></pre></div><p></p><p>在properties标签内部也可以定义一些属性<strong>作为补充</strong>，而当有相同字段时，<strong>优先读取外部配置文件</strong>中的属性。</p></li></ul><p>注意：xml文件中的标签是可以定义顺序的，如在核心配置文件中，必须遵守以下的标签顺序：</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525093326045-2024-12-922:09:05.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525093326045"><figcaption aria-hidden="true">image-20220525093326045</figcaption></figure><h3 id="类型别名typealiases">4.4、类型别名(typeAliases)</h3><p>类型别名是为Java类型<strong>设置一个短的名字</strong>。它只和XML配置有关，存在的意义仅在于用<strong>来减少类完全限定名的冗余。</strong></p><p>如之前返回值类型需要填写完整的类完全限定名com.hao.pojo.user，此时可以通过设置类型别名来使用一个简单名字来优化。</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.hao.pojo.User&quot;</span>&gt;</span>
    select * from mybatis.user;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>方法一：在typeAliases标签中为需要起别名的类，添加别名。</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--给类起别名--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.hao.pojo.User&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;User&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span></code></pre></div><p>方法二：可以指定一个包，MyBatis 会在包名下面搜索需要的 Java Bean。<strong>在没有注解的情况下</strong>，会使用 Bean 的<strong>首字母小写</strong>的非限定类名来作为它的别名。</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--给类起别名--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.hao.pojo&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span></code></pre></div><ul><li>比较</li></ul><p>在实体类较少的时候使用第一种方式，如果实体类较多则使用第二种。</p><p>第一种方式可以自定义别名，第二种则默认为类名首字母小写。若在第二种方式下也要自定义别名，需要在实体类上添加注解。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Alias(&quot;hello&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;&#125;</code></pre></div><h3 id="设置settings">4.5、设置(settings)</h3><p><strong>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。</strong></p><p>其中主要使用到的如下，其余见官网文档。</p><table><thead><tr class="header"><th style="text-align:left">设置名</th><th style="text-align:left">描述</th><th style="text-align:left">有效值</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr class="odd"><td style="text-align:left">cacheEnabled</td><td style="text-align:left">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td><td style="text-align:left">true | false</td><td style="text-align:left">true</td></tr><tr class="even"><td style="text-align:left">lazyLoadingEnabled</td><td style="text-align:left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td><td style="text-align:left">true | false</td><td style="text-align:left">false</td></tr><tr class="odd"><td style="text-align:left">useColumnLabel</td><td style="text-align:left">使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察。</td><td style="text-align:left">true | false</td><td style="text-align:left">true</td></tr><tr class="even"><td style="text-align:left">useGeneratedKeys</td><td style="text-align:left">允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）。</td><td style="text-align:left">true | false</td><td style="text-align:left">false</td></tr><tr class="odd"><td style="text-align:left">mapUnderscoreToCamelCase</td><td style="text-align:left">是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn。</td><td style="text-align:left">true | false</td><td style="text-align:left">false</td></tr><tr class="even"><td style="text-align:left">logImpl</td><td style="text-align:left">指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td><td style="text-align:left">SLF4J | LOG4J（3.5.9 起废弃） | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td><td style="text-align:left">未设置</td></tr></tbody></table><h3 id="其他配置">4.6、其他配置</h3><ul><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">typeHandlers（类型处理器）</a></li><li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#objectFactory">objectFactory（对象工厂）</a></li><li>plugins（插件）<ul><li>mybatis-generator-core</li><li><a target="_blank" rel="noopener" href="https://baomidou.com/pages/24112f/#%E7%89%B9%E6%80%A7">mybatis-plus</a></li><li>通用mapper</li></ul></li></ul><h3 id="映射器mapper">4.7、映射器(mapper)</h3><p>告诉mybatis去哪里寻找我们写好的SQL映射语句，即找到mapper.xml.</p><p>MapperRegistry：注册绑定我们的mapper文件</p><p><strong>方式一</strong>：使用相对于类路径的资源引用 (<strong>推荐</strong>)</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--每一个Mapper.xml文件都需要在mybatis核心配置文件中注册--&gt;</span>	
<span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;com/hao/mapper/UserMapper.xml&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre></div><p><strong>方式二</strong>：使用class文件绑定注册</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--每一个Mapper.xml文件都需要在mybatis核心配置文件中注册--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hao.mapper.UserMapper&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre></div><p>注意点：</p><ul><li>接口和它的mapper配置文件<strong>必须同名</strong></li><li>接口和它的mapper配置文件<strong>必须在同一个包下</strong>，否则找不到。</li></ul><p><strong>方式三</strong>：使用扫描包进行绑定</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--每一个Mapper.xml文件都需要在mybatis核心配置文件中注册--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.hao.mapper&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre></div><p>注意点：</p><ul><li>接口和它的mapper配置文件必须同名</li><li>接口和它的mapper配置文件必须在同一个包下，否则找不到。</li></ul><h3 id="生命周期和作用域">4.8、生命周期和作用域</h3><p>作用域和生命周期类别是至关重要的，因为错误的使用会导致非常严重的<strong>并发问题</strong>。</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525105645605-2024-12-922:09:25.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525105645605"><figcaption aria-hidden="true">image-20220525105645605</figcaption></figure><p><strong>SqlSessionFactoryBuilder</strong>：</p><ul><li>一旦创建了 SqlSessionFactory，就不再需要它了。</li><li>局部变量</li></ul><p><strong>SqlSessionFactory</strong></p><ul><li>可以想象为<strong>数据库连接池</strong></li><li>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，<strong>没有任何理由丢弃它或重新创建另一个实例</strong>。</li><li>因此 SqlSessionFactory 的最佳作用域是<strong>应用作用域</strong>。</li><li>最简单的就是使用单例模式或者静态单例模式。</li></ul><p><strong>SqlSession</strong></p><ul><li>相当于连接到连接池的一个请求</li><li>每个线程都应该有它自己的 SqlSession 实例。</li><li>SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是<strong>请求或方法作用域</strong>。</li><li>用完后赶紧关闭，否则会占用资源。</li></ul><p>三者关系：</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525111254216-2024-12-922:09:33.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525111254216"><figcaption aria-hidden="true">image-20220525111254216</figcaption></figure><p>这里的每一个Mapper，就代表一个具体的业务。</p><h2 id="五解决字段名和属性名不一致的问题">五、解决字段名和属性名不一致的问题</h2><h3 id="问题">5.1、问题</h3><p>数据库中的字段：</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525113551949-2024-12-922:09:42.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525113551949"><figcaption aria-hidden="true">image-20220525113551949</figcaption></figure><p>实体类的属性：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String password; <span class="hljs-comment">//和数据库中的不一致</span>
&#125;</code></pre></div><p>测试通过id获取用户，对应的sql语句</p><div class="code-wrapper"><pre><code class="hljs java">select * from mybatis.user <span class="hljs-type">where</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> #&#123;id&#125;;
<span class="hljs-comment">//---------&gt;</span>
select id, name, pwd from mybatis.user <span class="hljs-type">where</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> #&#123;id&#125;;</code></pre></div><p>结果出现异常：</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525113817281-2024-12-922:09:44.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525113817281"><figcaption aria-hidden="true">image-20220525113817281</figcaption></figure><p>解决方法：</p><p><strong>由于从数据库中取出的数据不能准确映射到实体类的属性，所以出现了错误。</strong></p><p>该例子中没有显式地配置一个resultMap,但MyBatis 会在幕后<strong>自动创建</strong>一个 <code>ResultMap</code>，再根据属性名来映射列到 JavaBean 的属性上。如果列名和属性名不能匹配上，可以在 SELECT 语句中设置列别名（这是一个基本的 SQL 特性）来完成匹配</p><ul><li><p>起别名</p><div class="code-wrapper"><pre><code class="hljs xml">select id, name, pwd as password from mybatis.user where id = #&#123;id&#125;;</code></pre></div></li></ul><h3 id="resultmap">5.2、resultMap</h3><p>结果集映射</p><div class="code-wrapper"><pre><code class="hljs java">id 	name 	pwd
id 	name 	password</code></pre></div><p>使用resultMap进行映射</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!--column 数据库中的字段  property 实体类的属性--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">result</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span>
    select * from mybatis.user where id = #&#123;id&#125;;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p><strong>resultMap</strong></p><ul><li><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。</li><li>ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。</li></ul><h2 id="六日志">六、日志</h2><h3 id="日志工厂">6.1、日志工厂</h3><p>如果一个数据库操作，出现了异常，我们需要排错。日志就是最好的助手！</p><p>曾经：sout，debug</p><p>现在：日志工厂！</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525163711323-2024-12-922:09:52.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525163711323"><figcaption aria-hidden="true">image-20220525163711323</figcaption></figure><ul><li>SLF4J</li><li>LOG4J(deprecated since 3.5.9) （掌握）</li><li>LOG4J2</li><li>JDK_LOGGING</li><li>COMMONS_LOGGING</li><li>STDOUT_LOGGING （掌握） 标准日志工厂实现</li><li>NO_LOGGING</li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logImpl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span></code></pre></div><p>测试时在控制台输出：</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525164842001-2024-12-922:10:45.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525164842001"><figcaption aria-hidden="true">image-20220525164842001</figcaption></figure><h3 id="log4j">6.2、Log4j</h3><p>什么是Log4j？</p><ul><li>Log4j是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Apache/8512995">Apache</a>的一个开源项目，通过使用Log4j，我们可以控制日志信息输送的目的地是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/控制台/2438626">控制台</a>、文件、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/GUI">GUI</a>组件，甚至是套接口服务器、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/NT/3443842">NT</a>的事件记录器、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/UNIX">UNIX</a> <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Syslog">Syslog</a><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/守护进程/966835">守护进程</a>等；</li><li>我们也可以控制每一条日志的输出格式</li><li>通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。</li><li>可以通过一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/配置文件/286550">配置文件</a>来灵活地进行配置，而不需要修改应用的代码。</li></ul><p>1、导包</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- log4j --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>2、添加配置 log4j.properties</p><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment">#将等级为DEBUG的日志信息输出到console和file这两个目的地，console和file的定义在下面的代码</span>
<span class="hljs-attr">log4j.rootLogger</span>=<span class="hljs-string">DEBUG,console,file</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#控制台输出的相关设置</span>
<span class="hljs-attr">log4j.appender.console</span> = <span class="hljs-string">org.apache.log4j.ConsoleAppender</span>
<span class="hljs-attr">log4j.appender.console.Target</span> = <span class="hljs-string">System.out</span>
<span class="hljs-attr">log4j.appender.console.Threshold</span>=<span class="hljs-string">DEBUG</span>
<span class="hljs-attr">log4j.appender.console.layout</span> = <span class="hljs-string">org.apache.log4j.PatternLayout</span>
<span class="hljs-attr">log4j.appender.console.layout.ConversionPattern</span>=<span class="hljs-string">[%c]-%m%n</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#文件输出的相关设置</span>
<span class="hljs-attr">log4j.appender.file</span> = <span class="hljs-string">org.apache.log4j.RollingFileAppender</span>
<span class="hljs-attr">log4j.appender.file.File</span>=<span class="hljs-string">./log/kuang.log</span>
<span class="hljs-attr">log4j.appender.file.MaxFileSize</span>=<span class="hljs-string">10mb</span>
<span class="hljs-attr">log4j.appender.file.Threshold</span>=<span class="hljs-string">DEBUG</span>
<span class="hljs-attr">log4j.appender.file.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span>
<span class="hljs-attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="hljs-string">[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">#日志输出级别</span>
<span class="hljs-attr">log4j.logger.org.mybatis</span>=<span class="hljs-string">DEBUG</span>
<span class="hljs-attr">log4j.logger.java.sql</span>=<span class="hljs-string">DEBUG</span>
<span class="hljs-attr">log4j.logger.java.sql.Statement</span>=<span class="hljs-string">DEBUG</span>
<span class="hljs-attr">log4j.logger.java.sql.ResultSet</span>=<span class="hljs-string">DEBUG</span>
<span class="hljs-attr">log4j.logger.java.sql.PreparedStatement</span>=<span class="hljs-string">DEBUG</span></code></pre></div><p>3、测试输出</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525172132457-2024-12-922:10:57.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525172132457"><figcaption aria-hidden="true">image-20220525172132457</figcaption></figure><p><strong>简单使用</strong></p><p>1、在要使用Log4j的类中，导入包 <code>import org.apache.log4j.Logger</code>;</p><p>2、日志对象，参数为当前类的class</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> Logger.getLogger(UserDaoTest.class);</code></pre></div><p>3、日志级别</p><div class="code-wrapper"><pre><code class="hljs java">logger.info(<span class="hljs-string">&quot;info:进入了testLog4j&quot;</span>);
logger.debug(<span class="hljs-string">&quot;debug:进入了testLog4j&quot;</span>);
logger.error(<span class="hljs-string">&quot;error:进入了testLog4j&quot;</span>);</code></pre></div><h2 id="七分页">七、分页</h2><h3 id="使用limit分页-推荐">7.1、使用limit分页 （推荐）</h3><div class="code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> limit startIndex,pageSize;</code></pre></div><p>在mybatis中使用</p><p>1、接口</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//分页查询</span>
List&lt;User&gt; <span class="hljs-title function_">getUserListByLimit</span><span class="hljs-params">(Map map)</span>;</code></pre></div><p>2、mapper.xml</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserListByLimit&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span>
    select * from mybatis.user limit #&#123;startIndex&#125;, #&#123;pageSize&#125;</code></pre></div><p>3、测试</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetUerListByLimit</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
    map.put(<span class="hljs-string">&quot;startIndex&quot;</span>,<span class="hljs-number">0</span>);
    map.put(<span class="hljs-string">&quot;pageSize&quot;</span>,<span class="hljs-number">2</span>);
    List&lt;User&gt; userList = mapper.getUserListByLimit(map);
    <span class="hljs-keyword">for</span>(User user:userList) &#123;
        System.out.println(user);
    &#125;
&#125;</code></pre></div><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525180052212-2024-12-922:11:05.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525180052212"><figcaption aria-hidden="true">image-20220525180052212</figcaption></figure><h3 id="rowbounds实现分页">7.2、RowBounds实现分页</h3><p>不再使用Sql实现，而是使用java对象 RowBounds。不推荐</p><p>1、接口</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//分页查询2</span>
List&lt;User&gt; <span class="hljs-title function_">getUserListByRowBounds</span><span class="hljs-params">()</span>;</code></pre></div><p>2、mapper.xml</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getUserListByRowBounds&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span>
    select * from mybatis.user;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>3、测试</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetUserListByRowBounds</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-comment">//RowBounds实现</span>
    <span class="hljs-type">RowBounds</span> <span class="hljs-variable">rowBounds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RowBounds</span>(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>);
    List&lt;User&gt; userList = sqlSession.selectList(<span class="hljs-string">&quot;com.hao.mapper.UserMapper.getUserListByRowBounds&quot;</span>, <span class="hljs-literal">null</span>, rowBounds);
    <span class="hljs-keyword">for</span> (User user : userList) &#123;
        System.out.println(user);
    &#125;
    sqlSession.close();
&#125;</code></pre></div><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525181339906-2024-12-922:11:13.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525181339906"><figcaption aria-hidden="true">image-20220525181339906</figcaption></figure><h3 id="分页插件">7.3、分页插件</h3><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220525181646324-2024-12-922:11:18.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220525181646324"><figcaption aria-hidden="true">image-20220525181646324</figcaption></figure><p><a target="_blank" rel="noopener" href="https://pagehelper.github.io/docs/">查看</a></p><h2 id="八使用注解开发">八、使用注解开发</h2><p>1、注解在接口上实现</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;
    <span class="hljs-meta">@Select(&quot;select * from mybatis.user&quot;)</span>
    List&lt;User&gt; <span class="hljs-title function_">getUserList</span><span class="hljs-params">()</span>;
&#125;</code></pre></div><p>2、<strong>在核心配置文件中绑定接口</strong></p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.hao.mapper.UserMapper&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></code></pre></div><p>3、测试</p><p>本质：反射机制</p><p>底层：动态代理</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220526171648377-2024-12-922:11:27.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220526171648377"><figcaption aria-hidden="true">image-20220526171648377</figcaption></figure><p><strong>Mybatis详细执行流程：</strong></p><p><img src="https://gitee.com/cmyk359/img/raw/master/img/mybatis-2024-12-922:11:32.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="mybatis" style="zoom:100%"></p><p><a target="_blank" rel="noopener" href="https://www.processon.com/diagraming/628d98f50e3e747f1e8dcde6">图片</a></p><h3 id="param">8.1、<span class="citation" data-cites="Param">@Param</span></h3><p>在实际的开发中，经常会遇到<strong>多个接口参数</strong>的情况。在之前的例子中，我们都是将多个参数合并到一个JavaBean中，但是不可能每次都为不同的参数创建一个新的JavaBean，所以需要使用其他方式来传递多个参数，常见的方法有使用<strong>Map类型</strong>和使用<strong><span class="citation" data-cites="param注解">@param注解</span></strong></p><p><span class="citation" data-cites="Param的作用就是">@Param的作用就是</span><strong>给参数命名</strong>，比如在mapper里面某方法A（int id），当添加注解后A（<span class="citation" data-cites="Param">@Param</span>("userId") int id），也就是说外部想要取出传入的id值，<strong>只需要取它的参数名userId就可以了</strong>。将参数值传如SQL语句中，通过#{userId}进行取值给SQL的参数赋值。</p><ul><li>方法存在多个参数，所有参数前面必须加上 <span class="citation" data-cites="Param">@Param</span>("")注解</li></ul><p>当使用@Param给参数命名后，在xml或注解形式下使用 #{}取值</p><p><strong>XML形式下</strong>：</p><ul><li><strong><span class="citation" data-cites="Param注解单一属性">@Param注解单一属性</span></strong><ul><li>这里给参数配置@param注解后，Mybatis会自动将参数封装成<strong>Map类型</strong>，而@param注解的值会成为Map中的key，因此在sql中可以通过配置的注解值来使用参数。</li><li>使用注解传递参数,这时是不涉及单独一个类型的,所以<strong>去掉parameterType属性</strong></li></ul></li><li><strong><span class="citation" data-cites="Param注解JavaBean对象">@Param注解JavaBean对象</span></strong><ul><li>当参数是JavaBean类型时，使用@param注解后就不能直接使用，而是要通过<strong>点取值</strong>的方式。</li><li>在没有注解时，可以直接使用该JavaBean的属性</li></ul></li></ul><p><strong>注解形式下：同上</strong></p><h3 id="crud">8.2、CRUD</h3><p>编写接口，增加注解</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;
    <span class="hljs-meta">@Select(&quot;select * from mybatis.user&quot;)</span>
    List&lt;User&gt; <span class="hljs-title function_">getUserList</span><span class="hljs-params">()</span>;

    <span class="hljs-meta">@Select(&quot;select * from mybatis.user where id = #&#123;userId&#125;&quot;)</span>
    User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;userId&quot;)</span> <span class="hljs-type">int</span> id)</span>;

    <span class="hljs-meta">@Insert(&quot;insert into user(id,name,pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;password&#125;)&quot;)</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span>;

    <span class="hljs-meta">@Update(&quot;update user set name = #&#123;user.name&#125; where id = #&#123;user.id&#125;&quot;)</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;user&quot;)</span> User user)</span>;

    <span class="hljs-meta">@Delete(&quot;delete from user where id = #&#123;uid&#125;&quot;)</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;uid&quot;)</span> <span class="hljs-type">int</span> id)</span>;
&#125;</code></pre></div><p>测试</p><blockquote><p>我们必须要将接口注册绑定到我们的核心配置文件中</p></blockquote><h2 id="九lombok">九、Lombok</h2><p>有好有坏，适当使用。</p><p>1、在IDEA中下载 LomBok插件</p><p>2、在项目中导入jar包</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.22<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>3、在实体类上添加注解</p><div class="code-wrapper"><pre><code class="hljs java">
<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String password;

&#125;</code></pre></div><p>所包含的注解：</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Getter</span> and <span class="hljs-meta">@Setter</span>
<span class="hljs-meta">@FieldNameConstants</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@EqualsAndHashCode</span>
<span class="hljs-meta">@AllArgsConstructor</span>, <span class="hljs-meta">@RequiredArgsConstructor</span> and <span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Log</span>, <span class="hljs-meta">@Log4j</span>, <span class="hljs-meta">@Log4j2</span>, <span class="hljs-meta">@Slf4j</span>, <span class="hljs-meta">@XSlf4j</span>, <span class="hljs-meta">@CommonsLog</span>, <span class="hljs-meta">@JBossLog</span>, <span class="hljs-meta">@Flogger</span>, <span class="hljs-meta">@CustomLog</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@SuperBuilder</span>
<span class="hljs-meta">@Singular</span>
<span class="hljs-meta">@Delegate</span>
<span class="hljs-meta">@Value</span>
<span class="hljs-meta">@Accessors</span>
<span class="hljs-meta">@Wither</span>
<span class="hljs-meta">@With</span>
<span class="hljs-meta">@SneakyThrows</span>
<span class="hljs-meta">@val</span>
<span class="hljs-meta">@var</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//常用</span>
<span class="hljs-meta">@Data</span> ：添加Getter、Setter、无参构造器、equals、hashCode、toString
<span class="hljs-meta">@AllArgsConstructor</span>： 添加有参构造器（所有参数）
<span class="hljs-meta">@Getter</span> and <span class="hljs-meta">@Setter</span>：可以加在类前面，也可以加在属性前面</code></pre></div><h2 id="十多对一处理">十、多对一处理</h2><ul><li>多个学生，对应一个老师</li></ul><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220527110704142-2024-12-922:11:51.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220527110704142"><figcaption aria-hidden="true">image-20220527110704142</figcaption></figure><ul><li>对于学生这边而言，<strong>关联</strong>..多个学生，关联一个老师【多对一】</li><li>对于老师而言，<strong>集合</strong>，一个老师，有很多学生【一对多】</li></ul><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220527103918366-2024-12-922:11:55.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220527103918366"><figcaption aria-hidden="true">image-20220527103918366</figcaption></figure><p>实体类</p><div class="code-wrapper"><pre><code class="hljs java">

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">//学生需要关联一个老师</span>
    <span class="hljs-keyword">private</span> Teacher teacher; <span class="hljs-comment">//对象</span>
&#125;

<span class="hljs-comment">//数据库中对应的列是 id name tid</span></code></pre></div><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.hao.pojo;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
&#125;
</code></pre></div><p>mapper</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StudentMapper</span> &#123;
    List&lt;Student&gt; <span class="hljs-title function_">getStudents</span><span class="hljs-params">()</span>;
&#125;</code></pre></div><p><strong>按照嵌套查询</strong></p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getStudents&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;stu_list&quot;</span>&gt;</span>
    select * from student
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;stu_list&quot;</span>   <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span>
    <span class="hljs-comment">&lt;!--复杂类型需要单独处理</span>
<span class="hljs-comment">            对象：association</span>
<span class="hljs-comment">            集合：collection</span>
<span class="hljs-comment">        --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;teacher&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tid&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;Teacher&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;getTeacher&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
<span class="hljs-comment">&lt;!--子查询--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTeacher&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span>
    select * from teacher where id = #&#123;tid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-comment">&lt;!--</span>
<span class="hljs-comment">通过子查询得到实体类所需的属性</span>
<span class="hljs-comment">--&gt;</span></code></pre></div><p><strong>按照连接查询</strong></p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getStudents&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;student_list&quot;</span>&gt;</span>
    select s.id sid, s.name sname, t.name tname
    from student s, teacher t
    where s.tid = t.id
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;student_list&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!--由于sql中使用了别名，数据库中的列名改为别名--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sid&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sname&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;teacher&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tname&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

<span class="hljs-comment">&lt;!--</span>
<span class="hljs-comment">使用连接查询，将所需要的的所有信息都查出来，由于此时的返回值不对应任何一个实体类，所以使用resultMap将查询到的值，都填到方法返回值所需的实体类中。</span>
<span class="hljs-comment">--&gt;</span></code></pre></div><p>测试</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-type">StudentMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(StudentMapper.class);
    List&lt;Student&gt; students = mapper.getStudents();
    <span class="hljs-keyword">for</span> (Student student : students) &#123;
        System.out.println(student);
    &#125;
&#125;</code></pre></div><p><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530093648543-2024-12-922:12:06.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530093648543" style="zoom:80%"></p><h2 id="十一一对多处理">十一、一对多处理</h2><p>比如：一个老师拥有多个学生。</p><p>对老师而言就是一对多的关系</p><p>实体类</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">//一个老师拥有多个学生</span>
    <span class="hljs-keyword">private</span> List&lt;Student&gt; students;
&#125;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> tid;
&#125;</code></pre></div><p>mapper</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TeacherMapper</span> &#123;

    <span class="hljs-comment">//获取指定老师的信息，及其所有学生的信息</span>
    Teacher <span class="hljs-title function_">getTeacher</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;tid&quot;)</span> <span class="hljs-type">int</span> id)</span>;
&#125;</code></pre></div><p><strong>按照结果嵌套处理，连接查询</strong></p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTeacher&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;teacher&quot;</span> &gt;</span>
    select s.id sid, s.name sname, t.name tname, t.id tid
    from student s, teacher t
    where s.tid = t.id and t.id = #&#123;tid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;teacher&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tid&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tname&quot;</span>/&gt;</span>
    <span class="hljs-comment">&lt;!--复杂类型需要单独处理</span>
<span class="hljs-comment">                对象：association</span>
<span class="hljs-comment">                集合：collection</span>
<span class="hljs-comment">            javaType=&quot;&quot;指定属性的类型</span>
<span class="hljs-comment">            集合中的泛型信息使用 ofType获取</span>
<span class="hljs-comment">        --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;students&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sid&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;sname&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;tid&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;tid&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

</code></pre></div><p><strong>嵌套查询</strong></p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTeacher&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;teacher&quot;</span> &gt;</span>
    select *
    from teacher
    where id = #&#123;tid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;teacher&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Teacher&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!--student的返回值类型：首先是ArrayList 其次内部泛型是Student--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;students&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;ArrayList&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;Student&quot;</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;getStudents&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
<span class="hljs-comment">&lt;!--子查询--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getStudents&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span>
    select *
    from student
    where tid = #&#123;tid&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h4 id="小结">小结</h4><ul><li><p>关联 --- association【多对一】</p></li><li><p>集合 --- collection【一对多】</p></li><li><p>javaType &amp; ofType</p><p>JavaType用来指定实体类中属性的类型</p><p>ofType用来指定映射到List或者集合中的pojo类型，泛型中的约束类型！</p></li></ul><h2 id="十二动态sql">十二、动态SQL</h2><p><strong>什么是动态SQL：动态SQL就是根据不同的条件生成不同的SQL语句</strong></p><p>所谓动态SQL，本质还是SQL语句，只是我们可以在SQL层面，执行一些逻辑代码。</p><h3 id="主要元素">12.1、主要元素</h3><ul><li>if</li><li>choose (when, otherwise)</li><li>trim (where, set)</li><li>foreach</li></ul><h3 id="if">12.2、IF</h3><p>使用动态 SQL 最常见情景是根据条件<strong>包含 where 子句的一部分</strong>。</p><p><code>&lt;if test="判断条件"&gt; where 子句的一部分 &lt;/if&gt;</code></p><p>根据判断条件是否为真来<code>动态拼接</code>对应的sql代码。</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530115235733-2024-12-922:12:18.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530115235733"><figcaption aria-hidden="true">image-20220530115235733</figcaption></figure><p>如，在博客表中：根据传入的查询条件查询相应的博客，若传入title不为空，则<strong>添加</strong>title模糊查询；若传入author不为空，<strong>添加</strong>author模糊查询条件；若不传入参数，则返回所有博客。</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getBlogIf&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Blog&quot;</span>&gt;</span>
    select *
    from blog
    where 1 = 1
    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span>
        and title like #&#123;title&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span>
        and author like #&#123;author&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>实际中不可能使用where 1= 1这样的语句，为了避免where之后 直接跟 逻辑运算符而导致SQL语句错误的情况，需要使用<code>&lt;where&gt; &lt;/where&gt;</code>标签。见下。</p><h3 id="choose-when-otherwise">12.3、choose (when, otherwise)</h3><p>有时候，我们不想使用所有的条件，而只是想从多个条件中选择一个使用。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p><p><strong>choose只选择执行其中一种情况，而if可以多个条件叠加</strong></p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">switch</span>	<span class="hljs-keyword">case</span>	<span class="hljs-keyword">case</span>	<span class="hljs-keyword">default</span>
choose  when	when	otherwise</code></pre></div><p>查询博客，若传入了 “title” 就按 “title” 查找，传入了 “author” 就按 “author”查找，若两者都没有传入就查询全部</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getBlogChoose&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Blog&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span>
    select * 
    from blog
    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">choose</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span>
                title = #&#123;title&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span>
                author = #&#123;author&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">otherwise</span>&gt;</span>
                views = #&#123;views&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">otherwise</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">choose</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><h3 id="trim-where-set">12.4、trim (where, set)</h3><p><strong>where</strong></p><ul><li><p>为了避免where之后 直接跟 逻辑运算符而导致SQL语句错误的情况，需要使用<code>&lt;where&gt; &lt;/where&gt;</code>标签。</p></li><li><p><em>where</em> 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。</p></li><li><p>而且，若子句的开头为 “AND” 或 “OR”，<em>where</em> 元素也会将它们去除。</p></li></ul><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getBlogIf&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Blog&quot;</span>&gt;</span>
    select *
    from blog
    where 1 = 1
    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span>
        and title like #&#123;title&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span>
        and author like #&#123;author&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>


===========================================================================&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getBlogIf&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Blog&quot;</span>&gt;</span>
        select *
        from blog
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span>
                title like #&#123;title&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span>
                and author like #&#123;author&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p><strong>set</strong></p><ul><li><p>用于动态更新语句的类似解决方案叫做 <em>set</em></p></li><li><p><em>set</em> 元素可以用于动态包含需要更新的列，忽略其它不更新的列。</p></li><li><p><em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p></li></ul><p>根据博客id更新博客内容</p><div class="code-wrapper"><pre><code class="hljs mysql">&lt;update id=&quot;updateBlog&quot; parameterType=&quot;map&quot;&gt;
    update blog
    &lt;set&gt;
        &lt;if test=&quot;tile != null&quot;&gt;
            title = #&#123;title&#125;,
        &lt;/if&gt;
        &lt;if test=&quot;author != null&quot;&gt;
            author = #&#123;author&#125;
        &lt;/if&gt;
    &lt;/set&gt;
    where id = #&#123;id&#125;
&lt;/update&gt;</code></pre></div><p>如上，不用写set关键字；若title不为空而author为空时，会自动去掉 title = #{title} , 中的逗号。</p><p><strong>trim</strong></p><ul><li>使用trim可以进一步定制where和set标签的功能</li></ul><h3 id="foreach">12.5、foreach</h3><ul><li><p>动态 SQL 的另一个常见使用场景是<strong>对集合进行遍历</strong>（尤其是在构建 IN 条件语句的时候）。</p></li><li><p>它允许你指定一个集合，声明可以在元素体内使用的<strong>集合项（item）</strong>和<strong>索引（index）</strong>变量。</p></li><li><p>它也允许你<strong>指定开头与结尾的字符串</strong>以及<strong>集合项迭代之间的分隔符</strong>。</p></li></ul><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530160534936-2024-12-922:12:29.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530160534936"><figcaption aria-hidden="true">image-20220530160534936</figcaption></figure><p>查询 1、2和3号博客</p><div class="code-wrapper"><pre><code class="hljs xml">#sql代码
select * from blog where id = 1 or id = 2 or id = 3;

#将其拼接成动态SQL
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getBlogForeach&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;blog&quot;</span>&gt;</span>
    select *
    from blog
    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;or&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span>
            id = #&#123;id&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>拼接后的sql为：</p><div class="code-wrapper"><pre><code class="hljs mysql">select * from blog WHERE ( id = ? or id = ? or id = ? )</code></pre></div><p>测试:</p><div class="code-wrapper"><pre><code class="hljs java">
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetBlogForeach</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-type">BlogMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(BlogMapper.class);
    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();
    ArrayList&lt;Integer&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();
    ids.add(<span class="hljs-number">1</span>);
    ids.add(<span class="hljs-number">2</span>);
    ids.add(<span class="hljs-number">3</span>);
    map.put(<span class="hljs-string">&quot;ids&quot;</span>,ids);
    List&lt;Blog&gt; blogs = mapper.getBlogForeach(map);
    <span class="hljs-keyword">for</span> (Blog blog : blogs) &#123;
        System.out.println(blog);
    &#125;
    sqlSession.close();
&#125;</code></pre></div><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530161516137-2024-12-922:12:35.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530161516137"><figcaption aria-hidden="true">image-20220530161516137</figcaption></figure><h3 id="sql片段">12.6、SQL片段</h3><p>有时候，我们要将一些功能的部分抽取出来，方便复用。</p><p>1、使用SQL标签抽取公共部分</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;if-title-author&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;title != null&quot;</span>&gt;</span>
        title like #&#123;title&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;author != null&quot;</span>&gt;</span>
        and author like #&#123;author&#125;
    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span></code></pre></div><p>2、在需要使用的地方 使用 include标签引用即可</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getBlogIf&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Blog&quot;</span>&gt;</span>
    select *
    from blog
    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;if-title-author&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><p>注意点：</p><ul><li>最好基于单表来定义SQL片段</li><li>其中不要包含where标签</li></ul><h2 id="十三缓存了解">十三、缓存（了解）</h2><h3 id="简介">13.1、简介</h3><p>1、什么是缓存[Cache]？</p><ul><li>保存在内存中的临时数据</li><li>将用户经常查询的数据放在缓存（内存）中，用户去查询数据就不用从磁盘上（关系型数据库数据文件）查询，从缓存中查询，从而提高查询效率，解决了高并发系统的性能问题。</li></ul><p>2、为什么使用缓存</p><ul><li><strong>减少和数据库的交互次数</strong>，减少系统开销，提高系统效率。</li></ul><p>3、什么样的数据能使用缓存</p><ul><li><strong>经常查询</strong>并且<strong>不经常改变</strong>的数据。</li></ul><h3 id="mybatis缓存">13.2、mybatis缓存</h3><p>Mybatis系统中默认定义了两级缓存：<strong>一级缓存</strong>和<strong>二级缓存</strong></p><ul><li>默认情况下，只有一级缓存开启。（SqlSession级别的缓存，也成本地缓存）</li><li>二级缓存需要手动开启。（namespace级别的缓存）</li><li>为了提高扩展性，MyBatis定义了缓存接口Cache。我们可以通过实现Cache接口来自定义二级缓存。</li></ul><h3 id="一级缓存">13.3、一级缓存</h3><p>一级缓存也叫本地缓存</p><ul><li><p>与数据库同一次会话期间查到的数据会存放在本地缓存中</p></li><li><p>以后如果需要获取<strong>相同的数据</strong>，直接从缓存中拿，而不用再一次去访问数据库。</p></li></ul><p>测试：首先开启日志。</p><p>测试在一个SQLSession中两次查询同一个用户，观察SQL执行情况。</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.getUserById(<span class="hljs-number">1</span>);
    System.out.println(user);
    System.out.println(<span class="hljs-string">&quot;===========================&quot;</span>);

    <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span>mapper.getUserById(<span class="hljs-number">1</span>);
    System.out.println(user1);
    System.out.println(user == user1);
    sqlSession.close();
&#125;</code></pre></div><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530204031937-2024-12-922:12:43.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530204031937"><figcaption aria-hidden="true">image-20220530204031937</figcaption></figure><p>缓存失效的情况：</p><ul><li><p>查询不同的东西</p></li><li><p><strong>增删改</strong>操作，可能会改变原来的数据，使缓存中的变为脏数据，所以必定会刷新缓存。</p></li><li><p>查询不同的Mapper.xml</p></li><li><p>手动清理缓存</p><p></p><div class="code-wrapper"><pre><code class="hljs java">sqlSession.clearCache(); <span class="hljs-comment">//手动清理缓存</span></code></pre></div><p></p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530204442286-2024-12-922:12:48.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530204442286"><figcaption aria-hidden="true">image-20220530204442286</figcaption></figure></li></ul><h3 id="二级缓存">13.4、二级缓存</h3><ul><li>二级缓存也叫全局缓存，一级缓存作用域太低了，所以诞生了二级缓存</li><li>基于namespace级别的缓存，一个名称空间，对应一个二级缓存；即一个Mapper对应一个二级缓存。</li><li><strong>工作机制</strong><ul><li>一个会话查询一条数据，这个数据就会<strong>首先</strong>被放在当前会话的一级缓存中；</li><li><strong>当前会话关闭时</strong>，该会话的一级缓存会被清理，此时会将一级缓存中的数据保存到二级缓存中。</li><li>新的会话查询信息，就可以从二级缓存中获取内容</li><li>不同mapper查出的数据会放在自己对应的缓存(map)中</li></ul></li></ul><p>步骤：</p><ol type="1"><li><p>开启全局缓存</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--显式开启，便于阅读，默认为开启状态--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span></code></pre></div></li><li><p>在要使用二级缓存的Mapper中开启</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--在当前mapper中开启二级缓存--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span>/&gt;</span></code></pre></div><p>也可以自定义参数</p><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cache</span></span>
<span class="hljs-tag">  <span class="hljs-attr">eviction</span>=<span class="hljs-string">&quot;FIFO&quot;</span></span>
<span class="hljs-tag">  <span class="hljs-attr">flushInterval</span>=<span class="hljs-string">&quot;60000&quot;</span></span>
<span class="hljs-tag">  <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;512&quot;</span></span>
<span class="hljs-tag">  <span class="hljs-attr">readOnly</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span></code></pre></div><p>创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p><p>可用的清除策略有：</p><ul><li><code>LRU</code> – 最近最少使用：移除最长时间不被使用的对象。</li><li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。</li><li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li><li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li></ul><p>默认的清除策略是 <strong>LRU</strong>。</p><ol start="3" type="1"><li>测试</li></ol><p>注意：实体类需要序列化，否则会报错</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;&#125;</code></pre></div></li></ol><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;
    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> sqlSession.getMapper(UserMapper.class);

    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.getUserById(<span class="hljs-number">1</span>);
    System.out.println(user);
    sqlSession.close(); <span class="hljs-comment">//关闭第一个会话</span>

    System.out.println(<span class="hljs-string">&quot;===========================&quot;</span>);

    <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession1</span> <span class="hljs-operator">=</span> MybatisUtils.getSqlSession();
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper1</span> <span class="hljs-operator">=</span> sqlSession1.getMapper(UserMapper.class);

    <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span>mapper1.getUserById(<span class="hljs-number">1</span>);
    System.out.println(user1);
    System.out.println(user == user1);
    sqlSession1.close();
&#125;</code></pre></div><p>关闭第一个会话后，其查询到数据会从一级缓存 转移到二级缓存，之后创建新的会话再次查询相同内容时，直接从二级缓存中读取。</p><figure><img src="https://gitee.com/cmyk359/img/raw/master/img/image-20220530214627595-2024-12-922:12:56.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="image-20220530214627595"><figcaption aria-hidden="true">image-20220530214627595</figcaption></figure><p>小结：</p><ul><li>只要开启了二级缓存，在同一个Mapper下就有效。</li><li>查询到的所有数据，会首先放在一级缓存中；只有当前会话提交或关闭时，才会提交到二级缓存</li></ul><h3 id="缓存原理">13.5、缓存原理</h3><p>一个查询语句查询的过程：</p><ul><li>先看二级缓存中有没有</li><li>再看一级缓存中有没有</li><li>若都没有，查询数据库</li></ul><h3 id="自定义缓存">13.6、自定义缓存</h3><p>之后主要使用 Redis缓存。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/JavaWeb/" class="category-chain-item">JavaWeb</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/MyBatis/" class="print-no-link">#MyBatis</a></div></div><div class="license-box my-3"><div class="license-title"><div>MyBatis</div><div>https://catpaws.top/1bff3c65/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>猫爪在上</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2024年12月9日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/bcfabe89/" title="Redis - 基础篇"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Redis - 基础篇</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/68ec802/" title="JavaWeb基础（二）后端相关"><span class="hidden-mobile">JavaWeb基础（二）后端相关</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="twikoo"></div><script type="text/javascript">Fluid.utils.loadComments("#comments",(function(){Fluid.utils.createScript("https://catpaws.top/blog-resource/twikoo1.6.42/twikoo.all.min.js",(function(){var t=Object.assign({envId:"https://catpaws-comments.netlify.app/.netlify/functions/twikoo",region:"ap-shanghai",path:"window.location.pathname"},{el:"#twikoo",path:"window.location.pathname",onCommentLoaded:function(){Fluid.utils.listenDOMLoaded((function(){var t="#twikoo .tk-content img:not(.tk-owo-emotion)";Fluid.plugins.imageCaption(t),Fluid.plugins.fancyBox(t)}))}});twikoo.init(t)}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js",(function(){mermaid.initialize({theme:"default"}),Fluid.utils.listenDOMLoaded((function(){Fluid.events.registerRefreshCallback((function(){"mermaid"in window&&mermaid.init()}))}))}))</script><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content">人山人海，欢迎你的到来 <i class="iconfont icon-love"></i><br><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><br><span><a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">本站由<img src="/img/upyun_logo.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload style="width:auto;height:auto">提供CDN加速/云存储服务</a></span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">陕ICP备2025059828号 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61032302000087" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" srcset="https://catpaws.top/blog-resource/imgs/transparent.svg" lazyload alt="police-icon"> <span>陕公网安备61032302000087号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="//catpaws.top/blog-resource/js/timeDate.js"></script><script src="//sdk.jinrishici.com/v2/browser/jinrishici.js"></script><script src="//catpaws.top/blog-resource/js/loader.js"></script><script src="//catpaws.top/blog-resource/js/blurpicload.js"></script><script src="//catpaws.top/blog-resource/js/axios.min.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script data-pjax src="https://catpaws.top/blog-resource/live2d/index.min.js"></script><script>const oml2d=OML2D.loadOml2d({dockedPosition:"left",mobileDisplay:!1,models:[{path:"https://catpaws.top/blog-resource/live2d/Frieren/Frieren.model3.json",motionPreloadStrategy:"IDLE",position:[-60,-100],scale:.06,stageStyle:{width:250,height:350}}],parentElement:document.body,primaryColor:"var(--btn-bg)",sayHello:!1,tips:{style:{width:200,height:90,left:"calc(50% - 20px)",top:"-100px","font-size":"14px"}}})</script></body></html>